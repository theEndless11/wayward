{"version":3,"sources":["server.js"],"names":["express","require","mongoose","cors","Ably","port","process","env","PORT","connect","MONGO_URI","useNewUrlParser","useUnifiedTopology","then","err","console","log","app","use","json","Message","Realtime","key","ABLY_API_KEY","publicChannel","ably","channels","get","message","newMessage","regeneratorRuntime","async","_context","prev","next","text","data","awrap","save","stop","req","res","messages","_context2","find","sort","timestamp","sent","t0","status","error","module","exports"],"mappings":"aAAA,IAAMA,QAAUC,QAAQ,WAClBC,SAAWD,QAAQ,YADnBD,KAAOC,QAAU,QAGjBE,KAAOF,QAAQ,QAFrBA,QAAMC,UAAWD,SACjB,IAAMG,IAAOH,UAKPI,KAAOC,QAAQC,IAAIC,MAAQ,IAHjCP,SAAQQ,QAARH,QAAAC,IAA4BG,UAAA,CAOxBC,iBAAiB,EACjBC,oBAAoB,IALxBC,KAAMR,WAAAA,OAAOC,QAAQC,IAAIC,uBAHzBP,MAWO,SAAAa,GAAG,OAAIC,QAAQC,IAAI,4BAA6BF,KAHnDF,IAAAA,QAAAA,QAAoB,aAElBK,IAJNC,IAAAlB,QAKOmB,QAAGF,IAAAC,IAAAf,QAGV,IAAMiB,KAAO,IAAGnB,KAAQoB,SAAA,CAADC,IAAgBhB,QAAAC,IAAAgB,eAEvCC,cAAAC,KAAAC,SAAAC,IAAA,QACAV,cAAQjB,UAAR,UAAA,SAAA4B,GAAA,IAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OACQ/B,EAER,IAAAiB,QAAA,CAAAe,KAAAP,EAAAQ,KAAAD,OAHAH,EAAAE,KAAA,EAAAJ,mBAAAO,MAUUR,EAAWS,QAVrB,KAAA,EAIMb,QAAOT,IAAIZ,uBAAcwB,EAAAQ,KAAAD,MAJ/B,KAAA,EAAA,IAAA,MAAA,OAAAH,EAAAO,YAeAtB,IAAIU,IAAI,YAAa,SAAOa,EAAKC,GAAZ,IAAAC,EAAA,OAAAZ,mBAAAC,MAAA,SAAAY,GAAA,OAAA,OAAAA,EAAAV,KAAAU,EAAAT,MAAA,KAAA,EAAA,OAAAS,EAAAV,KAAA,EAAAU,EAAAT,KAAA,EAAAJ,mBAAAO,MAPcjB,QAAAwB,OAAAC,KAAA,CAAAC,WAAA,KAOd,KAAA,EAPcJ,EAOdC,EAAAI,KAPcN,EAAAtB,KAAAuB,GAOdC,EAAAT,KAAA,GAAA,MAAA,KAAA,EAAAS,EAAAV,KAAA,EAAAU,EAAAK,GAAAL,EAAA,MAAA,GAPcF,EAAAQ,OAAA,KAAA9B,KAAA,CAAA+B,MAAA,6BAOd,KAAA,GAAA,IAAA,MAAA,OAAAP,EAAAJ,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,OAPctB,IAAAC,IAAAlB,QAAA,OAAA,WAAAmD,OAAAC,QAAAnC","file":"server.min.js","sourcesContent":["const express = require('express');\r\nconst mongoose = require('mongoose');\r\nconst Ably = require('ably');\r\nconst cors = require('cors');\r\nrequire('dotenv').config(); // To load environment variables from .env file\r\n\r\nconst app = express();\r\nconst port = process.env.PORT || 3000;\r\n\r\n// MongoDB connection using environment variable\r\nmongoose.connect(process.env.MONGO_URI, {\r\n    useNewUrlParser: true,\r\n    useUnifiedTopology: true\r\n})\r\n.then(() => console.log('MongoDB connected'))\r\n.catch(err => console.log('MongoDB connection error:', err));\r\n\r\n// Import the Message model\r\nconst Message = require('./message');  // Import schema from message.js\r\n\r\n// Use middleware\r\napp.use(express.json());\r\napp.use(cors());\r\n\r\n// Initialize Ably with API Key from environment variable\r\nconst ably = new Ably.Realtime({ key: process.env.ABLY_API_KEY });\r\nconst publicChannel = ably.channels.get('chat');\r\n\r\n// Listen for new messages on the public chat and save them to MongoDB\r\npublicChannel.subscribe('message', async (message) => {\r\n    const newMessage = new Message({ text: message.data.text });\r\n    await newMessage.save();\r\n    console.log('Message saved to DB:', message.data.text);\r\n});\r\n\r\n// API to get all messages from the MongoDB database\r\napp.get('/messages', async (req, res) => {\r\n    try {\r\n        const messages = await Message.find().sort({ timestamp: -1 });\r\n        res.json(messages);\r\n    } catch (err) {\r\n        res.status(500).json({ error: 'Failed to fetch messages' });\r\n    }\r\n});\r\n\r\n// Serve static files (HTML, JS, etc.) - if you have them in a public folder\r\napp.use(express.static('public'));\r\n\r\n// Vercel Serverless Function (For deployment on Vercel)\r\nmodule.exports = app;\r\n"]}