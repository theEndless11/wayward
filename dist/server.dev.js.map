{"version":3,"sources":["server.js"],"names":["express","require","mongoose","Ably","cors","config","app","port","process","env","PORT","connect","MONGO_URI","useNewUrlParser","useUnifiedTopology","then","console","log","err","messageSchema","Schema","text","type","String","required","timestamp","Date","now","Message","model","use","json","ably","Realtime","key","ABLY_API_KEY","publicChannel","channels","get","subscribe","message","newMessage","data","save","req","res","find","sort","messages","status","error","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\r\nconst mongoose = require('mongoose');\r\nconst Ably = require('ably');\r\nconst cors = require('cors');\r\nrequire('dotenv').config(); // To load environment variables from .env file\r\n\r\nconst app = express();\r\nconst port = process.env.PORT || 3000;\r\n\r\n// MongoDB connection using environment variable\r\nmongoose.connect(process.env.MONGO_URI, {\r\n    useNewUrlParser: true,\r\n    useUnifiedTopology: true\r\n})\r\n.then(() => console.log('MongoDB connected'))\r\n.catch(err => console.log('MongoDB connection error:', err));\r\n\r\n// MongoDB Message Model\r\nconst messageSchema = new mongoose.Schema({\r\n    text: { type: String, required: true },\r\n    timestamp: { type: Date, default: Date.now }\r\n});\r\n\r\nconst Message = mongoose.model('Message', messageSchema);\r\n\r\n// Use middleware\r\napp.use(express.json());\r\napp.use(cors());\r\n\r\n// Initialize Ably with API Key from environment variable\r\nconst ably = new Ably.Realtime({ key: process.env.ABLY_API_KEY });\r\nconst publicChannel = ably.channels.get('chat');\r\n\r\n// Listen for new messages on the public chat and save them to MongoDB\r\npublicChannel.subscribe('message', async (message) => {\r\n    const newMessage = new Message({ text: message.data.text });\r\n    await newMessage.save();\r\n    console.log('Message saved to DB:', message.data.text);\r\n});\r\n\r\n// API to get all messages from the MongoDB database\r\napp.get('/messages', async (req, res) => {\r\n    try {\r\n        const messages = await Message.find().sort({ timestamp: -1 });\r\n        res.json(messages);\r\n    } catch (err) {\r\n        res.status(500).json({ error: 'Failed to fetch messages' });\r\n    }\r\n});\r\n\r\n// Serve static files (HTML, JS, etc.) - if you have them in a public folder\r\napp.use(express.static('public'));\r\n\r\n// Vercel Serverless Function (For deployment on Vercel)\r\nmodule.exports = app;\r\n"],"file":"server.dev.js"}